#variables:
#  GIT_STRATEGY: clone
#  user: cloud_use
#default:
#  before_script:
#    - rm /root/.ssh/known_hosts
#    - touch /root/.ssh/known_hosts
#    - apk add sshpass 
stages:
 - deploy-to-prod
 - deploy-to-stag
to-prod:
 stage: deploy-to-prod
 rules:
  - if: '$CI_COMMIT_BRANCH == "develop"'
 script: 
  - pwd
  - ls -la
  - cd ../
  - pwd
  - sudo rm -rf /var/www/html/chicstays-backend
  - ls -la /var/www/html
  - sudo cp -r chicstays-backend/ /var/www/html/chicstays-backend
  - ls -la /var/www/html/chicstays-backend
  - cd /var/www/html/chicstays-backend
  - pwd
  - composer install
  - cp ~/.env .env
  - ls -la /var/www/html/chicstays-backend
 tags:
  - prod
 artifacts:
   paths:
     - results.log
   expire_in: 2 week

# 

to-stag:
 stage: deploy-to-stag
 rules:
  - if: '$CI_COMMIT_BRANCH =~ "milestone*"'
 script: 
  - pwd
  - ls -la
  - cd ../
  - pwd
  - sudo rm -rf /var/www/html/chicstays-backend
  - ls -la /var/www/html
  - sudo cp -r chicstays-backend/ /var/www/html/chicstays-backend
  - ls -la /var/www/html/chicstays-backend
  - cd /var/www/html/chicstays-backend
  - pwd
  - composer install
  - cp ~/.env .env
  - ls -la /var/www/html/chicstays-backend
 tags:
  - stag
 artifacts:
   paths:
     - results.log
   expire_in: 2 week  
